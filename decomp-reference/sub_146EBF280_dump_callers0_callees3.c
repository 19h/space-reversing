// Decompiled code dump generated by Code Dumper (Callers/Callees/Refs)
// Start Function: 0x146EBF280 (sub_146EBF280)
// Caller Depth: 0
// Callee/Ref Depth: 3
// Total Functions Found: 11
// ------------------------------------------------------------

// --- Function: get_tls_data_offset_784 (0x1402C4010) ---
// Retrieves a pointer to a thread-specific data structure. Accesses the TEB's
// ThreadLocalStoragePointer array using the global TlsIndex, retrieves the base
// pointer for this thread's data, and adds a fixed offset of 784 bytes.
__int64 get_tls_data_offset_784()
{
  return *((_QWORD *)NtCurrentTeb()->ThreadLocalStoragePointer + (unsigned int)TlsIndex) + 0x310LL;
}

// --- End Function: get_tls_data_offset_784 (0x1402C4010) ---

// --- Function: sub_1402D0950 (0x1402D0950) ---
unsigned __int64 __fastcall sub_1402D0950(__int64 a1)
{
  unsigned __int64 tls_data_offset_784; // rax
  unsigned __int64 v3; // rdx

  tls_data_offset_784 = get_tls_data_offset_784();
  if ( *(_DWORD *)(a1 + 8) == *(_DWORD *)(tls_data_offset_784 + 0x18)
    && (tls_data_offset_784 = *(unsigned int *)(a1 + 0xC), (_DWORD)tls_data_offset_784) )
  {
    tls_data_offset_784 = (unsigned int)(tls_data_offset_784 - 1);
    *(_DWORD *)(a1 + 0xC) = tls_data_offset_784;
  }
  else
  {
    v3 = _InterlockedDecrement64((volatile signed __int64 *)a1);
    if ( (v3 & 0x3FF) == 0 )
    {
      tls_data_offset_784 = 0xFFFF0000FFC00000uLL;
      if ( (v3 & 0xFFFF0000FFC00000uLL) != 0 )
      {
        return sub_1403C6F70((volatile signed __int64 *)a1, v3);
      }
    }
  }
  return tls_data_offset_784;
}

// --- End Function: sub_1402D0950 (0x1402D0950) ---

// --- Function: sub_1403C6C70 (0x1403C6C70) ---
void __fastcall sub_1403C6C70(volatile signed __int64 *a1, signed __int64 a2, __int64 a3, __int64 a4, char a5)
{
  int *p_n0x1600; // rcx
  int v8; // esi
  bool v9; // zf
  signed __int64 v10; // rax
  int v11; // [rsp+30h] [rbp-61h] BYREF
  _DWORD v12[3]; // [rsp+34h] [rbp-5Dh] BYREF
  int n0x1600_1; // [rsp+40h] [rbp-51h] BYREF
  __int64 v14; // [rsp+44h] [rbp-4Dh]
  int v15; // [rsp+4Ch] [rbp-45h]
  __int64 v16; // [rsp+50h] [rbp-41h]
  unsigned __int64 v17; // [rsp+58h] [rbp-39h]
  __int64 v18; // [rsp+60h] [rbp-31h]
  __int64 v19; // [rsp+68h] [rbp-29h]
  int n0x1600; // [rsp+90h] [rbp-1h] BYREF
  __int64 v21; // [rsp+94h] [rbp+3h]
  int v22; // [rsp+9Ch] [rbp+Bh]
  __int64 v23; // [rsp+A0h] [rbp+Fh]
  unsigned __int64 v24; // [rsp+A8h] [rbp+17h]
  __int64 v25; // [rsp+B0h] [rbp+1Fh]
  __int64 v26; // [rsp+B8h] [rbp+27h]

  if ( a5 && *(_BYTE *)(get_tls_data_offset_784() + 0x1C) && qword_14981D3D8 )
  {
    sub_1403C6E30(a1, a2);
    return;
  }
  if ( (a2 & 0x200000) != 0 )
  {
    while ( 1 )
    {
      if ( (a2 & 0xFFC00) != 0 )
      {
        (*(void (__fastcall **)(__int64, volatile signed __int64 *))(*(_QWORD *)qword_14981D318 + 0x128LL))(
          qword_14981D318,
          a1);
      }
      if ( (a2 & 0x100000) != 0 )
      {
        break;
      }
      v8 = a2 | 0x100000;
      v10 = _InterlockedCompareExchange64(a1, a2 | 0x100000, a2);
      v9 = a2 == v10;
      a2 = v10;
      if ( v9 )
      {
        n0x1600 = 0x1600;
        v21 = 0;
        v22 = 0;
        v24 = 0;
        v25 = 0;
        v26 = 0;
        v23 = 1;
        psub_7FF6AAB938D0(
          &n0x1600,
          0,
          &p_p_p_W__p4_src_CryEngine_Code_SDKs_Optick_1_3_1_src_optick_core_cpp,
          &p_p_p_W__p4_src_CryEngine_Code_SDKs_Optick_1_3_1_src_optick_core_cpp,
          0);
        v12[0] = v8;
        off_149808B88(a1, v12, 4, 0xFFFFFFFFLL);
        a2 = *a1;
        p_n0x1600 = &n0x1600;
        v24 = __rdtsc();
        goto LABEL_12;
      }
LABEL_13:
      if ( (a2 & 0x200000) == 0 )
      {
        return;
      }
    }
    n0x1600_1 = 0x1600;
    v14 = 0;
    v15 = 0;
    v17 = 0;
    v18 = 0;
    v19 = 0;
    v16 = 1;
    psub_7FF6AAB938D0(
      &n0x1600_1,
      0,
      &p_p_p_W__p4_src_CryEngine_Code_SDKs_Optick_1_3_1_src_optick_core_cpp,
      &p_p_p_W__p4_src_CryEngine_Code_SDKs_Optick_1_3_1_src_optick_core_cpp,
      0);
    v11 = a2;
    off_149808B88(a1, &v11, 4, 0xFFFFFFFFLL);
    a2 = *a1;
    p_n0x1600 = &n0x1600_1;
    v17 = __rdtsc();
LABEL_12:
    psub_7FF6AAB93930(p_n0x1600);
    goto LABEL_13;
  }
}

// --- End Function: sub_1403C6C70 (0x1403C6C70) ---

// --- Function: sub_1403C6E30 (0x1403C6E30) ---
double __fastcall sub_1403C6E30(volatile signed __int64 *a1, signed __int64 a2)
{
  __int64 v2; // r14
  __int64 tls_data_offset_784; // rax
  __int64 v6; // rsi
  unsigned int v7; // r15d
  unsigned __int64 v8; // rdx
  signed __int64 v9; // rax
  unsigned __int64 v10; // rcx
  signed __int64 v11; // rax
  signed __int64 v12; // rtt
  double result; // xmm0_8
  _BYTE v14[16]; // [rsp+30h] [rbp-19h] BYREF
  int n0x1600; // [rsp+40h] [rbp-9h] BYREF
  __int64 v16; // [rsp+44h] [rbp-5h]
  int v17; // [rsp+4Ch] [rbp+3h]
  __int64 v18; // [rsp+50h] [rbp+7h]
  unsigned __int64 v19; // [rsp+58h] [rbp+Fh]
  __int64 v20; // [rsp+60h] [rbp+17h]
  __int64 v21; // [rsp+68h] [rbp+1Fh]
  char v22; // [rsp+B8h] [rbp+6Fh] BYREF

  v2 = qword_14981D318;
  tls_data_offset_784 = get_tls_data_offset_784();
  v6 = *(_QWORD *)tls_data_offset_784;
  v7 = *(_DWORD *)(*(_QWORD *)tls_data_offset_784 + 0x1CLL);
  (*(void (__fastcall **)(__int64, _BYTE *, char *))(*(_QWORD *)v2 + 0xF8LL))(v2, v14, &v22);
  if ( (a2 & 0x200000) != 0 )
  {
    v8 = (unsigned __int64)v7 << 0x20;
    while ( 1 )
    {
      v9 = a2;
      if ( (a2 & 0xFFFF00000000LL) != 0 )
      {
        *(_DWORD *)(v6 + 0x24) = WORD2(a2);
        v10 = v8 | a2 & 0xFFFF0000FFFFFFFFuLL;
        v9 = a2;
      }
      else
      {
        *(_DWORD *)(v6 + 0x24) = 0xFFFFFFFF;
        v10 = a2 | v8;
      }
      v12 = v9;
      v11 = _InterlockedCompareExchange64(a1, v10, v9);
      a2 = v11;
      if ( v12 == v11 )
      {
        break;
      }
      if ( (v11 & 0x200000) == 0 )
      {
        return result;
      }
    }
    n0x1600 = 0x1600;
    v16 = 0;
    v17 = 0;
    v19 = 0;
    v20 = 0;
    v21 = 0;
    v18 = 1;
    psub_7FF6AAB938D0(
      &n0x1600,
      0,
      &p_p_p_W__p4_src_CryEngine_Code_SDKs_Optick_1_3_1_src_optick_core_cpp,
      &p_p_p_W__p4_src_CryEngine_Code_SDKs_Optick_1_3_1_src_optick_core_cpp,
      0);
    (*(void (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v2 + 0xE8LL))(v2, v7);
    v19 = __rdtsc();
    return psub_7FF6AAB93930(&n0x1600);
  }
  return result;
}

// --- End Function: sub_1403C6E30 (0x1403C6E30) ---

// --- Function: sub_1403C6F70 (0x1403C6F70) ---
__int64 __fastcall sub_1403C6F70(volatile signed __int64 *a1, unsigned __int64 a2)
{
  signed __int64 v4; // rdx
  unsigned int v5; // r8d
  __int64 result; // rax
  unsigned __int64 v7; // rbx
  int v8; // [rsp+60h] [rbp+8h] BYREF
  int v9; // [rsp+68h] [rbp+10h] BYREF
  __int64 v10; // [rsp+70h] [rbp+18h] BYREF
  __int64 v11; // [rsp+78h] [rbp+20h] BYREF

  while ( 1 )
  {
    v4 = a2;
    if ( (a2 & 0xFFC00000) == 0 )
    {
      (*(void (__fastcall **)(__int64, __int64 *, int *))(*(_QWORD *)qword_14981D318 + 0xF8LL))(
        qword_14981D318,
        &v10,
        &v8);
      v4 = a2 & 0xFFFFFFFFFFFFLL;
      v5 = *(_DWORD *)(0xC0 * (HIWORD(a2) & (unsigned int)(v8 - 1)) + v10 + 0x24);
      if ( v5 != 0xFFFFFFFF )
      {
        v4 |= (unsigned __int64)v5 << 0x30;
      }
    }
    result = _InterlockedCompareExchange64(a1, v4, a2);
    if ( a2 == result )
    {
      break;
    }
    if ( (result & 0x3FF) != 0 || (result & 0x200000) != 0 || (result & 0xFFFF0000FFC00000uLL) == 0 )
    {
      return result;
    }
    a2 = result;
  }
  if ( (a2 & 0xFFC00000) != 0 )
  {
    return off_149808B90(a1);
  }
  result = 0xFFFF000000000000uLL;
  if ( (a2 & 0xFFFF000000000000uLL) != 0 )
  {
    (*(void (__fastcall **)(__int64, __int64 *, int *))(*(_QWORD *)qword_14981D318 + 0xF8LL))(
      qword_14981D318,
      &v11,
      &v9);
    v7 = HIWORD(a2);
    *(_DWORD *)(0xC0LL * ((unsigned int)v7 & (v9 - 1)) + v11 + 0x1C) = (unsigned __int16)(v7 + v9);
    return (*(__int64 (__fastcall **)(__int64, _QWORD))(*(_QWORD *)qword_14981D318 + 0xD8LL))(
             qword_14981D318,
             (unsigned int)v7);
  }
  return result;
}

// --- End Function: sub_1403C6F70 (0x1403C6F70) ---

// --- Function: sub_146E9E400 (0x146E9E400) ---
__int64 __fastcall sub_146E9E400(__int64 _RSI, __int64 a2, __int64 a3)
{
  __int128 v3; // xmm6
  __int128 v4; // xmm7
  __int128 v5; // xmm8
  __int128 v6; // xmm9
  __int128 v7; // xmm10
  __int128 v8; // xmm11
  __int128 v9; // xmm12
  __int128 v10; // xmm13
  __int128 v11; // xmm14
  __int128 v12; // xmm15
  double v13; // xmm0_8
  double v16; // xmm7_8
  double v17; // xmm8_8
  double v18; // xmm9_8
  double v20; // xmm11_8
  double v22; // xmm6_8
  double v23; // xmm5_8
  double v24; // xmm5_8
  double v25; // xmm9_8
  double v26; // xmm8_8
  double v27; // xmm7_8
  __int64 result; // rax
  double v30; // xmm6_8
  __int128 v31; // kr00_16
  double v34; // xmm1_8
  double v36; // [rsp+20h] [rbp-138h]
  double _RBX_1; // [rsp+30h] [rbp-128h] BYREF
  double v38; // [rsp+38h] [rbp-120h]
  double v39; // [rsp+40h] [rbp-118h]
  double v40; // [rsp+48h] [rbp-110h]
  double v41; // [rsp+50h] [rbp-108h]
  double v42; // [rsp+60h] [rbp-F8h]
  _QWORD v43[29]; // [rsp+68h] [rbp-F0h]
  double v44; // [rsp+168h] [rbp+10h]
  double v45; // [rsp+170h] [rbp+18h]

  v13 = *(double *)a3;
  *(_OWORD *)&v43[0x1B] = v3;
  *(_OWORD *)&v43[0x19] = v4;
  v16 = *(double *)(a3 + 0x18);
  *(_OWORD *)&v43[0x17] = v5;
  v17 = *(double *)(a3 + 8);
  *(_OWORD *)&v43[0x15] = v6;
  v18 = *(double *)(a3 + 0x10);
  *(_OWORD *)&v43[0x13] = v7;
  _XMM10 = *(_OWORD *)(a3 + 0x20);
  *(_OWORD *)&v43[0x11] = v8;
  v20 = *(double *)(a3 + 0x30);
  *(_OWORD *)&v43[0xF] = v9;
  *(_OWORD *)&v43[0xD] = v10;
  *(_OWORD *)&v43[0xB] = v11;
  *(_OWORD *)&v43[9] = v12;
  v36 = v16;
  v45 = v17;
  v44 = v18;
  *(_OWORD *)v43 = _XMM10;
  sub_146EC33F0(_RSI, &_RBX_1, qword_14981D41C);
  __asm { vunpckhpd xmm3, xmm10, xmm10 }
  v22 = v20 * v38 - v39 * *(double *)&_XMM3 + *(double *)&_XMM10 * v40;
  v23 = *(double *)&_XMM10 * v39 - v20 * _RBX_1 + v40 * *(double *)&_XMM3;
  *(double *)&_XMM10 = v38 * (_RBX_1 * *(double *)&_XMM3 - *(double *)&_XMM10 * v38 + v20 * v40) - v39 * v23;
  v24 = _RBX_1 * v23 - v38 * v22;
  v25 = v18 * v38 - v17 * v39 + v13 * v40 + v16 * _RBX_1;
  v26 = v13 * v39 - _RBX_1 * v44 + v17 * v40 + v16 * v38;
  v27 = _RBX_1 * v45 - v13 * v38 + v40 * v44 + v16 * v39;
  result = a2;
  _XMM3 = *(_OWORD *)v43;
  v30 = v40 * v36 - v13 * _RBX_1 - v38 * v45 - v39 * v44;
  *((_QWORD *)&v31 + 1) = v43[1];
  __asm { vunpckhpd xmm0, xmm3, xmm3 }
  *(double *)&v31 = *(double *)v43 + *(double *)&_XMM10 + v41 + *(double *)&_XMM10;
  _XMM4 = v31;
  *(double *)&_XMM0 = v24 + v20 + v42;
  v34 = *(double *)(a3 + 0x38);
  *(double *)a2 = v25;
  *(double *)(a2 + 8) = v26;
  *(double *)(a2 + 0x10) = v27;
  *(double *)(a2 + 0x18) = v30;
  *(double *)&v31 = *(double *)&_XMM0 + v24;
  __asm { vunpcklpd xmm0, xmm4, xmm3 }
  *(_OWORD *)(a2 + 0x20) = _XMM0;
  *(double *)(a2 + 0x30) = *(double *)&v31;
  *(double *)(a2 + 0x38) = v34;
  return result;
}

// --- End Function: sub_146E9E400 (0x146E9E400) ---

// --- Function: sub_146EBF280 (0x146EBF280) ---
double *__fastcall sub_146EBF280(__int64 a1, double *a2, _DWORD *a3, int a4)
{
  unsigned __int64 v8; // r15
  int v9; // esi
  __int64 v10; // rax
  double v11; // xmm1_8
  char v12; // si
  signed __int64 v13; // r14
  __int64 _RSI; // rax
  __int64 v15; // rax
  double v16; // xmm1_8
  int n0xB00; // [rsp+30h] [rbp-59h] BYREF
  __int64 v19; // [rsp+34h] [rbp-55h]
  int v20; // [rsp+3Ch] [rbp-4Dh]
  __int64 v21; // [rsp+40h] [rbp-49h]
  unsigned __int64 v22; // [rsp+48h] [rbp-41h]
  __int64 v23; // [rsp+50h] [rbp-39h]
  __int64 v24; // [rsp+58h] [rbp-31h]
  _BYTE v25[64]; // [rsp+80h] [rbp-9h] BYREF

  n0xB00 = 0xB00;
  v19 = 0;
  v20 = 0;
  v22 = 0;
  v23 = 0;
  v24 = 0;
  v21 = 1;
  psub_7FF6AAB938D0(
    &n0xB00,
    0,
    &p_p_p_W__p4_src_CryEngine_Code_SDKs_Optick_1_3_1_src_optick_core_cpp,
    &p_p_p_W__p4_src_CryEngine_Code_SDKs_Optick_1_3_1_src_optick_core_cpp,
    0);
  if ( (*a3 & 0xFFFFFF) != 0xFFFFFF )
  {
    v8 = *(_QWORD *)(a1 + 0x48 * ((unsigned __int64)(unsigned int)*a3 >> 0x18) + 0xA12198)
       + (*a3 & 0xFFFFFF)
       * (unsigned __int64)*(unsigned __int16 *)(a1 + 2 * ((unsigned __int64)(unsigned int)*a3 >> 0x18) + 0xA12350);
    if ( a4 )
    {
      v9 = a4 - 2;
      if ( v9 )
      {
        v22 = __rdtsc();
        if ( v9 == 1 )
        {
          *a2 = 0.0;
          a2[1] = 0.0;
          a2[2] = 0.0;
        }
        goto LABEL_16;
      }
      v10 = *(unsigned __int16 *)(0x16LL * (*(_WORD *)(v8 + 8) & 0xF) + a1 + 0xA1235A);
      v11 = *(double *)(v10 + v8 + 0x60);
      *(_OWORD *)a2 = *(_OWORD *)(v10 + v8 + 0x50);
      a2[2] = v11;
    }
    else
    {
      v12 = *(_BYTE *)(*((_QWORD *)NtCurrentTeb()->ThreadLocalStoragePointer + (unsigned int)TlsIndex) + 0x9F0LL);
      if ( !v12 )
      {
        if ( *(_DWORD *)(a1 + 0x10) == *(_DWORD *)(get_tls_data_offset_784() + 0x18) )
        {
          ++*(_DWORD *)(a1 + 0x14);
        }
        else
        {
          v13 = _InterlockedIncrement64((volatile signed __int64 *)(a1 + 8));
          if ( (v13 & 0x200000) != 0 )
          {
            sub_1403C6C70(
              (volatile signed __int64 *)(a1 + 8),
              v13,
              (__int64)"CZoneSystem::GetPosition",
              (__int64)"m_GlobalStateLock",
              1);
          }
        }
      }
      _RSI = sub_146EC5840(a1, *(_DWORD *)(v8 + 0x10));
      v15 = sub_146E9E400(
              _RSI,
              (__int64)v25,
              v8 + *(unsigned __int16 *)(0x16LL * (*(_WORD *)(v8 + 8) & 0xF) + a1 + 0xA1235A) + 0x30LL);
      v16 = *(double *)(v15 + 0x30);
      *(_OWORD *)a2 = *(_OWORD *)(v15 + 0x20);
      a2[2] = v16;
      if ( !v12 )
      {
        sub_1402D0950(a1 + 8);
      }
    }
    v22 = __rdtsc();
LABEL_16:
    psub_7FF6AAB93930(&n0xB00);
    return a2;
  }
  *a2 = 0.0;
  a2[1] = 0.0;
  a2[2] = 0.0;
  v22 = __rdtsc();
  psub_7FF6AAB93930(&n0xB00);
  return a2;
}

// --- End Function: sub_146EBF280 (0x146EBF280) ---

// --- Function: sub_146EC2DB0 (0x146EC2DB0) ---
double *__fastcall sub_146EC2DB0(__int64 _RSI, double *_RBX)
{
  __int64 _RSI_1; // rcx
  double *v5; // rax
  double v6; // xmm7_8
  double v7; // xmm4_8
  double v8; // xmm15_8
  double v9; // xmm13_8
  double v10; // xmm14_8
  double v11; // xmm10_8
  double v12; // xmm12_8
  double v13; // xmm6_8
  double v14; // xmm5_8
  double v15; // xmm1_8
  double v16; // xmm7_8
  double v17; // xmm4_8
  double v18; // xmm8_8
  double v19; // kr00_8
  double v20; // xmm5_8
  double v21; // xmm11_8
  double v22; // xmm2_8
  double v23; // xmm6_8
  double v24; // xmm1_8
  double v25; // xmm4_8
  double v26; // xmm9_8
  double v27; // xmm1_8
  double v28; // xmm2_8
  double v29; // xmm0_8
  double v30; // xmm1_8
  double v31; // xmm2_8
  double v32; // kr00_8
  double _RBX_[8]; // [rsp+20h] [rbp-E8h] BYREF

  _RSI_1 = *(_QWORD *)(_RSI + 0x1B8);
  if ( _RSI_1 )
  {
    v5 = sub_146EC2DB0(_RSI_1, _RBX_);
    v6 = *(double *)(_RSI + 0x50);
    v7 = *(double *)(_RSI + 0x48);
    v8 = *(double *)(_RSI + 0x40);
    v9 = v5[1];
    v10 = v5[2];
    v11 = *v5;
    v12 = v5[3];
    v13 = v9 * v6 - v10 * v7 + v8 * v12;
    v14 = v8 * v10 - *v5 * v6 + v12 * v7;
    v15 = v12 * v6;
    v16 = *(double *)(_RSI + 0x30);
    v17 = *v5 * v7 - v8 * v9 + v15;
    v18 = v9 * v17 - v10 * v14;
    v19 = *v5 * v14;
    v20 = *(double *)(_RSI + 0x20);
    v21 = v19 - v9 * v13;
    v22 = v10 * v13;
    v23 = *(double *)(_RSI + 0x28);
    v24 = *v5 * v17;
    v25 = *(double *)(_RSI + 0x38);
    v26 = v22 - v24;
    *_RBX = v16 * v9 - v23 * v10 + v20 * v12 + v25 * *v5;
    _RBX[1] = v20 * v10 - v16 * v11 + v23 * v12 + v25 * v9;
    _RBX[2] = v23 * v11 - v20 * v9 + v16 * v12 + v25 * v10;
    v27 = v18 + v5[4];
    _RBX[3] = v25 * v12 - v20 * v11 - v23 * v9 - v16 * v10;
    v28 = v26 + v5[5];
    v29 = v26 + *(double *)(_RSI + 0x48);
    _RBX[4] = v27 + v8 + v18;
    v30 = v28 + v29;
    v31 = v21 + v5[6];
    v32 = v21 + *(double *)(_RSI + 0x50);
    _RBX[5] = v30;
    _RBX[6] = v31 + v32;
  }
  else
  {
    _RBX[3] = 1.0;
    *_RBX = 0.0;
    _RBX[1] = 0.0;
    _RBX[2] = 0.0;
    _RBX[4] = 0.0;
    _RBX[5] = 0.0;
    _RBX[6] = 0.0;
  }
  return _RBX;
}

// --- End Function: sub_146EC2DB0 (0x146EC2DB0) ---

// --- Function: sub_146EC33F0 (0x146EC33F0) ---
_QWORD *__fastcall sub_146EC33F0(__int64 _RSI, _QWORD *_RBX_1, unsigned int a3)
{
  __int64 v6; // rdi
  char v7; // bp
  signed __int64 v8; // rdx

  v6 = RCX + 8;
  v7 = *(_BYTE *)(*((_QWORD *)NtCurrentTeb()->ThreadLocalStoragePointer + (unsigned int)TlsIndex) + 0x9F0LL);
  if ( !v7 )
  {
    if ( *(_DWORD *)(v6 + 8) == *(_DWORD *)(get_tls_data_offset_784() + 0x18) )
    {
      ++*(_DWORD *)(v6 + 0xC);
    }
    else
    {
      v8 = _InterlockedIncrement64((volatile signed __int64 *)v6);
      if ( (v8 & 0x200000) != 0 )
      {
        sub_1403C6C70(
          (volatile signed __int64 *)v6,
          v8,
          (__int64)"CZone::GetTransform_ws",
          (__int64)"g_pZoneSystem->m_GlobalStateLock",
          1);
      }
    }
  }
  if ( *(_DWORD *)(_RSI + 0x174) != *(_DWORD *)(RCX + 0xA00154) )
  {
    sub_146EEEAD0(_RSI, a3);
  }
  if ( *(_BYTE *)(RCX + 0xA00150) )
  {
    sub_146EC2DB0(_RSI, (double *)_RBX_1);
  }
  else
  {
    _RBX_1[3] = *(_QWORD *)(_RSI + 0xE0);
    *_RBX_1 = *(_QWORD *)(_RSI + 0xC8);
    _RBX_1[1] = *(_QWORD *)(_RSI + 0xD0);
    _RBX_1[2] = *(_QWORD *)(_RSI + 0xD8);
    *((_OWORD *)_RBX_1 + 2) = *(_OWORD *)(_RSI + 0xE8);
    *((double *)_RBX_1 + 6) = *(double *)(_RSI + 0xF8);
  }
  if ( !v7 )
  {
    sub_1402D0950(v6);
  }
  return _RBX_1;
}

// --- End Function: sub_146EC33F0 (0x146EC33F0) ---

// --- Function: sub_146EC5840 (0x146EC5840) ---
__int64 __fastcall sub_146EC5840(__int64 a1, int a2)
{
  if ( a2 == 0xFFFFFFFF )
  {
    return 0;
  }
  if ( (_WORD)a2 )
  {
    if ( (__int64)(*(_QWORD *)(a1 + 0xA00108) - *(_QWORD *)(a1 + 0xA00100)) >> 3 <= (unsigned __int64)(unsigned __int16)a2 )
    {
      __debugbreak();
    }
    if ( *(_WORD *)(*(_QWORD *)(a1 + 0xA00100) + 8LL * (unsigned __int16)a2 + 6) != HIWORD(a2) )
    {
      return 0;
    }
  }
  if ( (__int64)(*(_QWORD *)(a1 + 0xA00108) - *(_QWORD *)(a1 + 0xA00100)) >> 3 <= (unsigned __int64)(unsigned __int16)a2 )
  {
    __debugbreak();
  }
  return *(_QWORD *)(*(_QWORD *)(a1 + 0xA00100) + 8LL * (unsigned __int16)a2) & 0xFFFFFFFFFFFFLL;
}

// --- End Function: sub_146EC5840 (0x146EC5840) ---

// --- Function: sub_146EEEAD0 (0x146EEEAD0) ---
__int64 __fastcall sub_146EEEAD0(__int64 _RDI, unsigned int a2)
{
  __int64 _RCX; // rsi
  __int64 _RDI_1; // rdi
  char v5; // r15
  signed __int64 v6; // rdx
  volatile signed __int32 *v7; // rbx
  unsigned __int32 v8; // eax
  __int64 _RCX_1; // rcx
  _DWORD *v10; // r14
  unsigned __int64 v18; // rcx
  unsigned __int64 v19; // rax
  double *v27; // rax
  double v28; // xmm7_8
  double v29; // xmm4_8
  double v30; // xmm15_8
  double v31; // xmm13_8
  double v32; // xmm14_8
  double v33; // xmm12_8
  double v34; // xmm6_8
  double v35; // xmm5_8
  double v36; // xmm1_8
  double v37; // xmm7_8
  double v38; // kr00_8
  double v39; // xmm4_8
  double v40; // kr00_8
  double v41; // xmm0_8
  double v42; // xmm6_8
  double v43; // xmm3_8
  double v44; // xmm5_8
  double v45; // xmm6_8
  double v47; // xmm2_8
  unsigned __int128 v49; // xmm9
  double v50; // xmm11_8
  double v51; // xmm10_8
  double v52; // xmm8_8
  double v53; // xmm7_8
  double v54; // xmm6_8
  __int128 v55; // kr00_16
  __int64 result; // rax
  double v59; // [rsp+30h] [rbp-188h]
  _QWORD _RBX_1[7]; // [rsp+A8h] [rbp-110h] BYREF
  double v61; // [rsp+1C0h] [rbp+8h]
  double v62; // [rsp+1D0h] [rbp+18h]
  double v63; // [rsp+1D8h] [rbp+20h]

  _RCX = RCX;
  _RDI_1 = _RDI;
  v5 = *(_BYTE *)(*((_QWORD *)NtCurrentTeb()->ThreadLocalStoragePointer + (unsigned int)TlsIndex) + 0x9F0LL);
  if ( !v5 )
  {
    if ( *(_DWORD *)(_RCX + 0x10) == *(_DWORD *)(get_tls_data_offset_784() + 0x18) )
    {
      ++*(_DWORD *)(_RCX + 0x14);
    }
    else
    {
      v6 = _InterlockedIncrement64((volatile signed __int64 *)(_RCX + 8));
      if ( (v6 & 0x200000) != 0 )
      {
        sub_1403C6C70(
          (volatile signed __int64 *)(_RCX + 8),
          v6,
          (__int64)"CZone::RefreshWorldSpacePosition",
          (__int64)"g_pZoneSystem->m_GlobalStateLock",
          1);
      }
    }
  }
  v7 = (volatile signed __int32 *)(_RDI_1 + 0x170);
  v8 = _InterlockedCompareExchange((volatile signed __int32 *)(_RDI_1 + 0x170), 1, 0);
  if ( v8 )
  {
    sub_1403BF290((volatile signed __int32 *)(_RDI_1 + 0x170), v8, (__int64)"CZone::RefreshWorldSpacePosition", 1);
  }
  _RCX_1 = RCX;
  v10 = (_DWORD *)(_RDI_1 + 0x174);
  if ( *(_DWORD *)(_RDI_1 + 0x174) != *(_DWORD *)(RCX + 0xA00154) )
  {
    if ( *(_QWORD *)(_RDI_1 + 0x1B8) )
    {
      if ( a2 != *(_DWORD *)(_RDI_1 + 0x178) )
      {
        *(_DWORD *)(_RDI_1 + 0x178) = a2;
        *(_QWORD *)(_RDI_1 + 0x138) = *(_QWORD *)(_RDI_1 + 0xC8);
        _XMM2 = *(unsigned __int64 *)(_RDI_1 + 0xD0);
        *(double *)(_RDI_1 + 0x140) = *(double *)&_XMM2;
        _XMM3 = *(unsigned __int64 *)(_RDI_1 + 0xD8);
        *(double *)(_RDI_1 + 0x148) = *(double *)&_XMM3;
        _XMM4 = *(unsigned __int64 *)(_RDI_1 + 0xE0);
        *(double *)(_RDI_1 + 0x150) = *(double *)&_XMM4;
        *(_OWORD *)(_RDI_1 + 0x158) = *(_OWORD *)(_RDI_1 + 0xE8);
        *(double *)(_RDI_1 + 0x168) = *(double *)(_RDI_1 + 0xF8);
        _XMM5 = *(unsigned __int64 *)(_RDI_1 + 0x158);
        _XMM6 = *(unsigned __int64 *)(_RDI_1 + 0x160);
        _XMM7 = *(unsigned __int64 *)(_RDI_1 + 0x168);
        _R8 = *(_QWORD *)(RCX + 0xA00130);
        v18 = (*(_QWORD *)(RCX + 0xA00138) - _R8) >> 7;
        while ( (__int64)v18 > 0 )
        {
          v19 = v18 >> 1 << 7;
          if ( *(_DWORD *)(v19 + _R8 + 0x78) >= *(_DWORD *)(_RDI_1 + 0xC) )
          {
            v18 >>= 1;
          }
          else
          {
            _R8 += v19 + 0x80;
            v18 += 0xFFFFFFFFFFFFFFFFuLL - (v18 >> 1);
          }
        }
        __asm
        {
          vmovddup xmm0, qword ptr [rdi+138h]
          vmovupd xmmword ptr [r8], xmm0
          vmovddup xmm0, xmm3
          vmovddup xmm1, xmm2
          vmovupd xmmword ptr [r8+20h], xmm0
          vmovupd xmmword ptr [r8+10h], xmm1
          vmovddup xmm0, xmm5
          vmovddup xmm1, xmm4
          vmovupd xmmword ptr [r8+40h], xmm0
          vmovupd xmmword ptr [r8+30h], xmm1
          vmovddup xmm0, xmm7
          vmovddup xmm1, xmm6
          vmovupd xmmword ptr [r8+60h], xmm0
          vmovupd xmmword ptr [r8+50h], xmm1
        }
        *(_DWORD *)(_R8 + 0x70) = a2;
        v10 = (_DWORD *)(_RDI_1 + 0x174);
      }
      v27 = (double *)sub_146EC33F0(*(_QWORD *)(_RDI_1 + 0x1B8), _RBX_1, a2);
      v28 = *(double *)(_RDI_1 + 0x50);
      v29 = *(double *)(_RDI_1 + 0x48);
      v30 = *(double *)(_RDI_1 + 0x40);
      v31 = v27[1];
      v32 = v27[2];
      v33 = v27[3];
      v34 = v31 * v28 - v32 * v29 + v33 * v30;
      v35 = v30 * v32 - *v27 * v28 + v33 * v29;
      v36 = v33 * v28;
      v37 = *(double *)(_RDI_1 + 0x30);
      v38 = v31 * (*v27 * v29 - v30 * v31 + v36);
      v39 = *(double *)(_RDI_1 + 0x38);
      v40 = v38 - v35 * v32;
      v41 = v34 * v31;
      v42 = *(double *)(_RDI_1 + 0x28);
      v43 = v35 * *v27;
      v44 = *(double *)(_RDI_1 + 0x20);
      v61 = v37 * v31 - v42 * v32 + v44 * v33 + v39 * *v27;
      v62 = v44 * v32 - v37 * *v27 + v42 * v33 + v39 * v31;
      v63 = v42 * *v27 - v44 * v31 + v37 * v33 + v39 * v32;
      v45 = v39 * v33 - v44 * *v27 - v42 * v31 - v37 * v32;
      _XMM4 = COERCE_UNSIGNED_INT64(v40 + v27[4] + v40 + v30);
      v47 = v43 - v41 + v27[6] + v43 - v41 + *(double *)(_RDI_1 + 0x50);
      v59 = v45;
      *(double *)(_RDI_1 + 0xC8) = v61;
      *(double *)(_RDI_1 + 0xE0) = v45;
      *(double *)(_RDI_1 + 0xD0) = v62;
      *(double *)(_RDI_1 + 0xD8) = v63;
      __asm { vunpcklpd xmm0, xmm4, xmm3 }
      *(_OWORD *)(_RDI_1 + 0xE8) = _XMM0;
      *(double *)(_RDI_1 + 0xF8) = v47;
      v49 = *(unsigned __int64 *)(_RDI_1 + 0xE8) ^ (unsigned __int128)0x8000000000000000uLL;
      *(_QWORD *)&v50 = *(_QWORD *)(_RDI_1 + 0xF8) ^ 0x8000000000000000uLL;
      *(_QWORD *)&v51 = *(_QWORD *)(_RDI_1 + 0xF0) ^ 0x8000000000000000uLL;
      v52 = v51 * v63 - v62 * v50 + v45 * *(double *)&v49;
      v53 = v50 * v61 - *(double *)&v49 * v63 + v45 * v51;
      v54 = v63 * v53 - v62 * (v62 * *(double *)&v49 - v51 * v61 + v45 * v50);
      *(double *)(_RDI_1 + 0x100) = COERCE_DOUBLE(*(_QWORD *)&v61 ^ 0x8000000000000000uLL);
      *(double *)(_RDI_1 + 0x108) = COERCE_DOUBLE(*(_QWORD *)&v62 ^ 0x8000000000000000uLL);
      *(double *)(_RDI_1 + 0x110) = COERCE_DOUBLE(*(_QWORD *)&v63 ^ 0x8000000000000000uLL);
      *((_QWORD *)&v55 + 1) = *((_QWORD *)&v49 + 1);
      *(double *)&v55 = *(double *)&v49 + v54 + v54;
      _XMM4 = v55;
      *(double *)(_RDI_1 + 0x118) = v59;
      __asm { vunpcklpd xmm0, xmm4, xmm2 }
      *(_OWORD *)(_RDI_1 + 0x120) = _XMM0;
      *(double *)(_RDI_1 + 0x130) = v50 + v62 * v52 - v53 * v61 + v62 * v52 - v53 * v61;
      _RCX_1 = RCX;
    }
    *v10 = *(_DWORD *)(_RCX_1 + 0xA00154);
  }
  result = (unsigned int)_InterlockedCompareExchange(v7, 0, 1);
  if ( (_DWORD)result != 1 )
  {
    result = sub_1403D6A80(v7, result);
  }
  if ( !v5 )
  {
    return sub_1402D0950(_RCX + 8);
  }
  return result;
}

// --- End Function: sub_146EEEAD0 (0x146EEEAD0) ---

